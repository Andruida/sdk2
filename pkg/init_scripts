# SDK2 package definition for init scripts

# Set package-specific variables

PKG_NAME=init_scripts

SRC_DIR=$PKG_NAME
BUILD_DIR=$SRC_DIR

# Functions

unpack () {

    echo "Unpacking $PKG_NAME into $SD"

    # Copy the autoconf script

    rm -rf $SD
    mkdir $SD

    cp ${SDK2_PROFILE_ROOT}/common/init_scripts/preq_check.ac ${SD}/

}

build () {

    echo "Building $PKG_NAME in $BD"

    # Build

    cd $BD

    autoconf -o preq_check preq_check.ac

    if [ $? -ne 0 ]; then
	echo "FAILED in autoconf for $PKG_NAME"
	exit 1
    fi

}    

install () {

    echo "Installing $PKG_NAME from $BD"

    # Make the etc directory

    rm -rf ${DEST_ROOT}/etc
    mkdir -pv ${DEST_ROOT}/etc

    # Copy init scripts

    cd $BD

    cp -av ${PD}/init_scripts/init.sh ${DEST_ROOT}/bin/${PROFILE_NAME}_init.sh
    cp -av ${PD}/init_scripts/init.csh ${DEST_ROOT}/bin/${PROFILE_NAME}_init.csh
    
    cp -av ${SDK2_PROFILE_ROOT}/common/init_scripts/arch_check ${DEST_ROOT}/bin/${PROFILE_NAME}_arch_check
    cp -av preq_check ${DEST_ROOT}/bin/${PROFILE_NAME}_preq_check

    # Create the version script

    version_date=`date "+%Y%m%d"`
    version_arch=$PROFILE_ARCH
    version_string="${version_arch}-${version_date}"

    sed -e s/@VERSION_STRING@/${version_string}/g \
	${SDK2_PROFILE_ROOT}/common/init_scripts/version > ${DEST_ROOT}/bin/${PROFILE_NAME}_version
    chmod a+x ${DEST_ROOT}/bin/${PROFILE_NAME}_version

}
